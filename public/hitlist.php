<?php/** * The past is a ghost, the future a dream. All we ever have is now. â€“Bill Cosby. * @author: Ian <brokenlust@live.co.uk> * @version 1 * @package DeadlyMafia * @copyright Deadly Mafia 2014 */include "includes/functions.php";include "includes/config/hitlist.config.php";$iHitlistCount = $db->query("SELECT COUNT(*) FROM hitlist")->fetchColumn();if(isset($_POST['hitlist'])){    /**     * Which user to hitlist     * @var string     */    $sHitlistUsername   = $_POST['hitlist_user'];    /**     * The reason given on the histlist section "reason"     * @var string     */    $sReason            = $_POST['reason'];    /**     * The reward in dollars after the kill has been confirmed     * @var int     */    $iAmount            = (int)$_POST['amount'];    /**     * Is the person adding the target anonymous?     * @var int     */    $iAnonymous         = (int)$_POST['anonymous'];    //Check if the user entered exists    $iExists = $db->prepare("SELECT COUNT(*) FROM users WHERE username = ? AND username != ?");    $iExists->execute(array($sHitlistUsername, $oUser->username));    if($iExists->fetchColumn() > 0)    {        $iCost = $iAmount + HitlistConfig::$anonymousCost + HitlistConfig::$hitlistCost;        //Check if anonymous        if($iAnonymous === '1' && $oUser->money <= $iCost)            $sMessage = 'You cannot afford to be anonymous!';        else        {            $oQuery = $db->prepare("SELECT * FROM users WHERE username = ?");            $oQuery->execute(array($sHitlistUsername));            $oTarget = $oQuery->fetchObject();            try            {                $db->beginTransaction();                $oInsertHitlist = $db->prepare("INSERT INTO hitlist (`userid`, `username`, `targetid`, `targetusername`, `reason`, `amount`, `anonymous`)                                VALUES (?,?,?,?,?,?,?)");                $oInsertHitlist->execute(array($oUser->id, $oUser->username, $oTarget->id, $oTarget->username, $sReason, $iAmount, $iAnonymous));                $oMoney = $db->prepare("UPDATE users SET money = money-? WHERE id = ?");                $oMoney->execute(array($iCost, $oUser->id));                $db->commit();                $sMessage = $_POST['hitlist_user'] . ' has been hitlisted! Reason: ' . $_POST['reason'];            }            catch (Exception $e)            {                $db->rollBack();                $sMessage = 'An error has occured, please try again later';            }        }    }    else    {        $sMessage = 'Either that user doesn\'t exist, or you have tried adding your name to the hitlist';    }}?>    <!DOCTYPE html>    <html>        <head>            <title></title>            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">            <?=$style;?>        </head>        <body>            <?=(isset($sMessage)) ? $sMessage : ''?>            <table>                <thead>                    <tr>                        <th colspan="4">Hitlist</th>                    </tr>                </thead>                <tbody>                    <tr>                        <td>Target</td>                        <td>Paid By</td>                        <td>Reason</td>                        <td>Reward</td>                    </tr>                    <?php                    if($iHitlistCount > 0)                    {                        $oHitlist = $db->query("SELECT * FROM hitlist");                        while($row = $oHitlist->fetchObject())                        {                            $username = ($row->anonymous === '0') ? $row->username : 'Anonymous';                            echo "<tr><td>{$row->targetusername}</td><td>{$username}</td><td>{$row->reason}</td><td>{$row->amount}</td></tr>";                        }                    }                    else                    {                        echo "<tr><td colspan='4'>No targets acquired</td></tr>";                    }                    ?>                </tbody>            </table>            <form action="" method="post">                <table>                    <thead>                        <tr>                            <th>Add your enemy</th>                        </tr>                    </thead>                    <tbody>                        <tr>                            <td>                                Username to hitlist: <input type="text" placeholder="Enemies username" name="hitlist_user" />                            </td>                        </tr>                        <tr>                            <td>Reason<textarea name="reason"></textarea></td>                        </tr>                        <tr>                            <td>Reward<input type="text" placeholder="$1,000,000" name="amount"/> </td>                        </tr>                        <tr>                            <td>Anoymous?                            <br />Yes<input type="radio" name="anonymous" value="1">                            <br />No<input type="radio" name="anonymous" value="0" checked></td>                        </tr>                        <tr>                            <td><input type="submit" value="Add Target" name="hitlist" /></td>                        </tr>                    </tbody>                </table>            </form>        </body>    </html>
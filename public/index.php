<?phpsession_start();include_once './includes/db_connect.php';include_once "includes/config/game.config.php";include_once "includes/class/functions.class.php";//Log them outif(isset($_GET['logout']) == "yes"){    session_destroy();    header('Location: ' . GameConfig::$site_url . 'index.php');}if((isset($_POST['login']) && isset($_POST['email']))){    $email = $_POST['email'];    $password = hash('sha512', $_POST['password']);    $query = $db->prepare("SELECT COUNT(*) as count, users.id AS id, users.masterid AS masterid FROM users_master LEFT JOIN users ON users_master.id = users.masterid WHERE email = :email AND password = :password LIMIT 1");    $query->execute(array(':email'=>$email, ':password'=>$password));    $fetch = $query->fetchObject();    if($fetch->count == 1)    {        //Set the session        GameConfig::setSessions(array($fetch->id, $fetch->masterid));        //Update the user table with stats        $date = Functions::date();        try {            $db->beginTransaction();            $db->query("UPDATE users SET lastonline = " . $date . " WHERE userid = " . $fetch->id);            $db->commit();        }catch (Exception $e)        {            $db->rollBack($e);        }        header('Location: powder.php');    }    else        $error_message = "Incorrect login details";    }if(GameConfig::hasLoginSessions()){    header('Location: powder.php');}?><!DOCTYPE html><html>    <head>        <title></title>        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    </head>    <body>        <?=isset($error_message) ? $error_message : ''?>        <form method="POST" action="">            <input type="text" name="email" placeholder="E-mail address" />            <input type="password" name="password" placeholder="Password" />            <input type="submit" name="login" value="Login" />        </form>        <a href="?auth=twitter">Twitter Auth</a><br />        <a href="?auth=facebook">Facebook</a>        <?php include_once 'includes/footer.php'; ?>
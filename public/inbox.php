<?php/** * The past is a ghost, the future a dream. All we ever have is now. â€“Bill Cosby. * @author: Ian <brokenlust@live.co.uk> * @version 1 * @package DeadlyMafia * @copyright Deadly Mafia 2014 */include "includes/functions.php";?><!DOCTYPE html><html>    <head>        <title></title>        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        <?=$style;?>    </head>    <body>        <?php        if(isset($_GET['action']) && isset($_GET['id']))        {            if($_GET['action'] === 'view')            {                //Get conversations                $oConversations = $db->query("SELECT * FROM conversation_messages INNER JOIN conversations ON conversation_messages.convo_id = conversations.id WHERE convo_id = {$_GET['id']}");                while($rows = $oConversations->fetchObject())                {                    //Check to see whos ID it is                    $id = ($rows->toid === $userid) ? $rows->userid : $rows->toid;                    //Display header                    echo "<table>                            <thead>                                <tr>                                    <th>Your conversation with {$id}</th>                                </tr>                            </thead>                            <tbody>";                    //If the message was posted by you then display written by you, else written by other guy                    if($rows->cm_userid === $userid)                    {                        echo "<tr><td class=\"text-align: left\">Written by you: {$rows->messages}</td>";                    }                    else                    {                        echo "<tr><td class=\"text-align: right\">Written by Dave: {$rows->messages}</td>";                    }                    echo "</tbody></table>";                }            ?>            <?php            }            elseif($_GET['action'] === '')            {}        }        else        {            echo "            <table>                <thead>                    <tr>                        <th>Your conversations</th>                    </tr>                </thead>                <tbody>";            $iConversations = $db->query("SELECT COUNT(*) FROM conversations WHERE userid = {$userid} OR toid = {$userid}")->fetchColumn();            if($iConversations > 0)            {                $oConversations = $db->query("SELECT * FROM conversation_messages INNER JOIN conversations ON conversation_messages.convo_id = conversations.id WHERE conversations.userid = {$userid} OR conversations.toid = {$userid} GROUP BY conversations.id");                while($rows = $oConversations->fetchObject())                {                    if(strlen($rows->messages) > 30)                        $preview = substr($rows->messages, 0, 30) . '...';                    else                        $preview = $rows->messages;                    echo "<tr><td>Written By: {$rows->userid}</td></tr>";                    echo "<tr><td><a href=\"inbox.php?action=view&id={$rows->convo_id}\">{$preview}</a></td></tr>";                }            }        }        ?>    </body></html>